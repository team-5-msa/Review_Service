# MSA ì•„í‚¤í…ì²˜ êµ¬í˜„ ê°€ì´ë“œ

## ğŸ“Œ ì „ì²´ WorkFlow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         Client                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“ (HTTP Request + JWT)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  API Gateway / í”„ë¡ì‹œ                            â”‚
â”‚  - JWT í† í° ê²€ì¦ (í•œ ê³³ì—ì„œë§Œ!)                                 â”‚
â”‚  - userId ì¶”ì¶œ                                                  â”‚
â”‚  - x-user-id í—¤ë” ì¶”ê°€                                          â”‚
â”‚  - ë¼ìš°íŒ… (Auth Service, Performance Service, Review Service ë“±) â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†™          â†™           â†™
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”  â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”
        â†“            â†“  â†“         â†“  â†“             â†“
    [Auth Svc]  [Performance]  [Review Svc] [Reservation Svc] ...
```

## ğŸ” ReviewService ì¸ì¦ ë°©ì‹

### Primary: í”„ë¡ì‹œì—ì„œ ë°›ì€ `x-user-id` í—¤ë”

**í”„ë¡œë•ì…˜ í™˜ê²½ì—ì„œ ì‚¬ìš©**

```bash
# API Gatewayê°€ ì´ë ‡ê²Œ ìš”ì²­ì„ ì „ë‹¬í•¨
curl -H "x-user-id: user123" \
     -H "Authorization: Bearer jwt-token" \
     http://review-service/reviews/my
```

**ì¥ì :**

- âœ… JWT ê²€ì¦ì„ í”„ë¡ì‹œê°€ ì¼ê´„ ì²˜ë¦¬ (ì¤‘ë³µ ì œê±°)
- âœ… ê° ì„œë¹„ìŠ¤ëŠ” ì‹ ë¢°í•  ìˆ˜ ìˆëŠ” í—¤ë”ë§Œ ì½ìŒ
- âœ… ì„±ëŠ¥ ìµœì í™” (í† í° ë””ì½”ë”© 1íšŒ)
- âœ… ë³´ì•ˆ ê°•í™” (í”„ë¡ì‹œì˜ ì¤‘ì•™ ê²€ì¦)

### Fallback: `Authorization` í—¤ë”ì˜ Bearer Token

**ê°œë°œ/í…ŒìŠ¤íŠ¸ í™˜ê²½ì—ì„œ ì‚¬ìš©**

```bash
# ë¡œì»¬ ê°œë°œ ì‹œ
curl -H "Authorization: Bearer user-identifier" \
     http://localhost:3000/reviews/my
```

## ğŸ“‹ ReviewService ì—”ë“œí¬ì¸íŠ¸

### ì¸ì¦ì´ í•„ìš”í•œ ì—”ë“œí¬ì¸íŠ¸ (`@UseGuards(UserGuard)`)

#### 1. ë‚´ ë¦¬ë·° ì¡°íšŒ

```http
GET /reviews/my
Authorization: Bearer <token> ë˜ëŠ” x-user-id: <userId>
```

**ì‘ë‹µ:** í˜„ì¬ ì‚¬ìš©ìê°€ ì‘ì„±í•œ ëª¨ë“  ë¦¬ë·°

#### 2. ê³µì—°ë³„ ë¦¬ë·° ì¡°íšŒ (ì¸ì¦ í•„ìˆ˜)

```http
GET /reviews/performance/:performanceId
Authorization: Bearer <token> ë˜ëŠ” x-user-id: <userId>
```

**ì‘ë‹µ:** í•´ë‹¹ ê³µì—°ì˜ ëª¨ë“  ë¦¬ë·°

#### 3. ë¦¬ë·° ì‘ì„±

```http
POST /reviews
Content-Type: application/json
Authorization: Bearer <token> ë˜ëŠ” x-user-id: <userId>

{
  "performanceId": 1,
  "rating": 5,
  "content": "ì •ë§ ì¢‹ì€ ê³µì—°ì´ì—ˆìŠµë‹ˆë‹¤!"
}
```

**ì‘ë‹µ:** ìƒì„±ëœ ë¦¬ë·° ê°ì²´

#### 4. ë¦¬ë·° ìˆ˜ì •

```http
PATCH /reviews/:id
Content-Type: application/json
Authorization: Bearer <token> ë˜ëŠ” x-user-id: <userId>

{
  "rating": 4,
  "content": "ìˆ˜ì •ëœ ë‚´ìš©"
}
```

**ì‘ë‹µ:** ìˆ˜ì •ëœ ë¦¬ë·° ê°ì²´
**ê¶Œí•œ:** ë³¸ì¸ ë¦¬ë·°ë§Œ ìˆ˜ì • ê°€ëŠ¥

#### 5. ë¦¬ë·° ì‚­ì œ

```http
DELETE /reviews/:id
Authorization: Bearer <token> ë˜ëŠ” x-user-id: <userId>
```

**ì‘ë‹µ:** `{ "message": "ë¦¬ë·°ê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤." }`
**ê¶Œí•œ:** ë³¸ì¸ ë¦¬ë·°ë§Œ ì‚­ì œ ê°€ëŠ¥

## ğŸ”„ íŒ€ í˜‘ë ¥ ë°©ì‹

### Auth Service ë‹´ë‹¹ì

- [ ] JWT í† í° ìƒì„±/ê²€ì¦ ë¡œì§ êµ¬í˜„
- [ ] í”„ë¡ì‹œì— `x-user-id` í—¤ë” ì¶”ê°€ ë¡œì§ êµ¬í˜„
- [ ] í† í° ë§Œë£Œ ë° ë¦¬í”„ë ˆì‹œ ë¡œì§

### Performance Service ë‹´ë‹¹ì

- [ ] ê³µì—° CRUD ì—”ë“œí¬ì¸íŠ¸ êµ¬í˜„
- [ ] ê¶Œí•œ ê²€ì¦ (ê´€ë¦¬ìë§Œ ìˆ˜ì •/ì‚­ì œ)
- [ ] ReviewServiceì™€ì˜ í˜‘ë ¥ (ê³µì—° ID ìœ íš¨ì„± í™•ì¸)

### Review Service (í˜„ì¬)

- [x] ë¦¬ë·° CRUD ì—”ë“œí¬ì¸íŠ¸ êµ¬í˜„
- [x] ì‚¬ìš©ìë³„ ë¦¬ë·° í•„í„°ë§
- [x] `x-user-id` í—¤ë” ê¸°ë°˜ ì¸ì¦
- [x] Swagger ë¬¸ì„œí™”

### Reservation Service ë‹´ë‹¹ì

- [ ] ì¢Œì„ ì˜ˆì•½ ë¡œì§
- [ ] 10ë¶„ íƒ€ì„ì•„ì›ƒ ì²˜ë¦¬ (Cron Job)
- [ ] ì˜ˆì•½ ìƒíƒœ ê´€ë¦¬ (PENDING â†’ CONFIRMED â†’ CANCELED/REFUNDED)

## ğŸ§ª ë¡œì»¬ í…ŒìŠ¤íŠ¸

### 1. í”„ë¡ì‹œ ì—†ì´ í…ŒìŠ¤íŠ¸ (Bearer Token)

```bash
# Postman ë˜ëŠ” curl
curl -H "Authorization: Bearer user-001" \
     http://localhost:3000/reviews/my
```

### 2. í”„ë¡ì‹œ í¬í•¨ í…ŒìŠ¤íŠ¸ (x-user-id)

```bash
# API Gatewayê°€ í—¤ë”ë¥¼ ì¶”ê°€í•˜ëŠ” ìƒí™© ì‹œë®¬ë ˆì´ì…˜
curl -H "x-user-id: user-001" \
     -H "Authorization: Bearer valid-jwt-token" \
     http://localhost:3000/reviews/my
```

## ğŸ“š Swagger UI ì ‘ê·¼

- **ë¡œì»¬:** `http://localhost:3000/swagger-ui.html`
- **ë°°í¬:** `https://review-service-zeta.vercel.app/swagger-ui.html`

## âœ… ì²´í¬ë¦¬ìŠ¤íŠ¸

- [x] ReviewService ì´ˆê¸° êµ¬í˜„
- [x] x-user-id í—¤ë” ê¸°ë°˜ ì¸ì¦
- [x] Bearer Token í´ë°± ì¸ì¦
- [x] Swagger UI ë¶„ë¦¬
- [ ] Auth Service ì—°ë™
- [ ] Performance Service ê³µì—° ID ê²€ì¦
- [ ] í†µí•© í…ŒìŠ¤íŠ¸
- [ ] ë°°í¬
